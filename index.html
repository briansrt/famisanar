<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/iconfamisanar.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Portal de Agendamientos Famisanar - Agenda tus citas médicas en Cemdi Famisanar de manera rápida y sencilla. Disponible 24/7." />
    <meta name="keywords" content="citas médicas, agendamiento, Cemdi Famisanar, salud, consultas médicas, portal de citas" />
    <meta name="author" content="Cemdi Famisanar" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Portal de Agendamientos Famisanar - Agenda tus citas médicas" />
    <meta property="og:description" content="Simplifica tus citas médicas con nuestro portal inteligente de agendamientos. Disponible 24/7 en Cemdi Famisanar." />
    <meta property="og:image" content="/og-image.jpg" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="Portal de Agendamientos Famisanar - Agenda tus citas médicas" />
    <meta property="twitter:description" content="Simplifica tus citas médicas con nuestro portal inteligente de agendamientos. Disponible 24/7 en Cemdi Famisanar." />
    
    <title>Portal de Agendamientos Famisanar - Agenda tus citas médicas</title>
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Vapi Widget Script - Load immediately -->
    <script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" type="text/javascript"></script>

    <!-- Initialize Vapi widget and arrow + event handlers -->
    <script type="text/javascript">
      // Function to show the arrow
      function showWidgetArrow(position) {
        const arrow = document.getElementById('widget-arrow');
        if (arrow) {
          const svg = arrow.querySelector('svg path');
          
          // Update arrow position and direction based on widget position
          if (position === 'bottom') {
            arrow.style.top = 'auto';
            arrow.style.bottom = '120px';
            // Arrow points down (towards bottom widget)
            if (svg) svg.setAttribute('d', 'M12 4L12 16M12 16L8 12M12 16L16 12');
          } else {
            arrow.style.bottom = 'auto';
            arrow.style.top = '120px';
            // Arrow points up (towards top widget)
            if (svg) svg.setAttribute('d', 'M12 20L12 8M12 8L8 12M12 8L16 12');
          }

          setTimeout(function() {
            arrow.style.opacity = '1';
          }, 2000); // Show after 2 seconds
        }
      }

      // Function to hide the arrow
      function hideWidgetArrow() {
        const arrow = document.getElementById('widget-arrow');
        if (arrow) {
          arrow.style.opacity = '0';
          setTimeout(function() {
            arrow.style.display = 'none';
          }, 500);
        }
      }

      // Hide arrow when user clicks anywhere (indicating they see the widget)
      document.addEventListener('click', function(e) {
        // Only hide if clicking outside the widget area
        if (!e.target.closest('vapi-widget') && !e.target.closest('.widget-arrow')) {
          const arrow = document.getElementById('widget-arrow');
          if (arrow && arrow.style.opacity === '1') {
            hideWidgetArrow();
          }
        }
      });

      // Also hide when scrolling (user is engaged)
      let scrollTimeout;
      window.addEventListener('scroll', function() {
        const arrow = document.getElementById('widget-arrow');
        if (arrow && arrow.style.opacity === '1') {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(function() {
            hideWidgetArrow();
          }, 1500);
        }
      });

      // Desktop toggling between Chat and Voice widgets
      document.addEventListener('DOMContentLoaded', function() {
        const chatDesktop = document.querySelector('.widget-desktop');
        const voiceDesktop = document.querySelector('.widget-desktop-voice');

        // Create slider toggle (desktop) - initially hidden
        const sliderContainer = document.createElement('div');
        sliderContainer.id = 'widget-switch';
        sliderContainer.style.cssText = 'position:fixed; right:20px; top:80px; z-index:998; display:none;';
        sliderContainer.innerHTML = `
          <label class="toggle">
            <input id="toggle-mode" type="checkbox" />
            <span class="slider">
              <span class="label-left">Voz</span>
              <span class="label-right">Chat</span>
            </span>
          </label>
        `;
        document.body.appendChild(sliderContainer);

        // Create slider toggle (mobile) - initially hidden
        const sliderContainerMobile = document.createElement('div');
        sliderContainerMobile.id = 'widget-switch-mobile';
        sliderContainerMobile.style.cssText = 'position:fixed; right:20px; bottom:80px; z-index:998; display:none;';
        sliderContainerMobile.innerHTML = `
          <label class="toggle toggle-mobile">
            <input id="toggle-mode-mobile" type="checkbox" />
            <span class="slider">
              <span class="label-left">Voz</span>
              <span class="label-right">Chat</span>
            </span>
          </label>
        `;
        document.body.appendChild(sliderContainerMobile);

        // Function to handle responsive controls
        const handleResponsiveControls = () => {
          const sw = document.getElementById('widget-switch');
          const swMobile = document.getElementById('widget-switch-mobile');
          const chatMobile = document.querySelector('.widget-mobile-chat');
          const voiceMobile = document.querySelector('.widget-mobile-voice');
          
          if (window.innerWidth <= 768) {
            // Hide desktop slider, show mobile slider
            if (sw) sw.style.display = 'none';
            if (swMobile) swMobile.style.display = 'flex';
            
            // Hide desktop widgets
            if (chatDesktop) chatDesktop.style.display = 'none';
            if (voiceDesktop) voiceDesktop.style.display = 'none';
            
            // Show mobile chat by default, hide voice
            if (chatMobile) chatMobile.style.display = 'block';
            if (voiceMobile) voiceMobile.style.display = 'none';
            
            showWidgetArrow('bottom');
          } else {
            // Show desktop slider, hide mobile slider
            if (sw) sw.style.display = 'flex';
            if (swMobile) swMobile.style.display = 'none';
            
            // Desktop por defecto: Chat visible, Voz oculta
            if (chatDesktop) chatDesktop.style.display = 'block';
            if (voiceDesktop) voiceDesktop.style.display = 'none';
            
            // Hide mobile widgets
            if (chatMobile) chatMobile.style.display = 'none';
            if (voiceMobile) voiceMobile.style.display = 'none';
            
            showWidgetArrow('top');
          }
        };
        
        // Call after creating sliders
        handleResponsiveControls();
        window.addEventListener('resize', handleResponsiveControls);

        // Desktop slider event listener
        const toggle = document.getElementById('toggle-mode');
        if (toggle){
          toggle.addEventListener('change', (e) => {
            const toVoice = e.target.checked;
            if (toVoice){
              // Mostrar voz (top-right), ocultar chat
              if (chatDesktop) chatDesktop.style.display = 'none';
              if (voiceDesktop) voiceDesktop.style.display = 'block';
              showWidgetArrow('top');
            } else {
              // Mostrar chat (top-right), ocultar voz
              if (chatDesktop) chatDesktop.style.display = 'block';
              if (voiceDesktop) voiceDesktop.style.display = 'none';
              showWidgetArrow('top');
            }
          });
        }

        // Mobile slider event listener
        const toggleMobile = document.getElementById('toggle-mode-mobile');
        if (toggleMobile){
          toggleMobile.addEventListener('change', (e) => {
            const toVoice = e.target.checked;
            const chatMobile = document.querySelector('.widget-mobile-chat');
            const voiceMobile = document.querySelector('.widget-mobile-voice');
            
            if (toVoice){
              // Mostrar voz (bottom-right), ocultar chat
              if (chatMobile) chatMobile.style.display = 'none';
              if (voiceMobile) voiceMobile.style.display = 'block';
              showWidgetArrow('bottom');
            } else {
              // Mostrar chat (bottom-right), ocultar voz
              if (chatMobile) chatMobile.style.display = 'block';
              if (voiceMobile) voiceMobile.style.display = 'none';
              showWidgetArrow('bottom');
            }
          });
        }

        // Attach event listeners to all widgets (if present)
        const attachHandlers = (widget, label) => {
          if (!widget) return;
          widget.addEventListener('call-start', () => console.log(label, 'call-start'));
          widget.addEventListener('call-end',   () => console.log(label, 'call-end'));
          widget.addEventListener('message',    (e) => console.log(label, 'message:', e.detail));
          widget.addEventListener('error',      (e) => console.error(label, 'error:', e.detail));
        };
        attachHandlers(chatDesktop,  '[DESKTOP-CHAT]');
        attachHandlers(voiceDesktop, '[DESKTOP-VOICE]');
        
        const chatMobile = document.querySelector('.widget-mobile-chat');
        const voiceMobile = document.querySelector('.widget-mobile-voice');
        attachHandlers(chatMobile, '[MOBILE-CHAT]');
        attachHandlers(voiceMobile, '[MOBILE-VOICE]');
      });
    </script>
    
    <!-- Google Fonts (optional - for better typography) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }

      ::-webkit-scrollbar-thumb {
        background: #14B8A6;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #0f766e;
      }
      
      /* Loading animation */
      .loading-spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(20, 184, 166, 0.3);
        border-radius: 50%;
        border-top-color: #14B8A6;
        animation: spin 1s ease-in-out infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Smooth scroll behavior */
      html {
        scroll-behavior: smooth;
      }
      
      /* Font family */
      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(to bottom right, #ffffff, #f8fafc);
      }
    </style>
  </head>
  <body>
    <!-- Vapi Widget - Desktop (top-right) -->
    <vapi-widget
      class="widget-desktop"
      public-key="d1b861f9-2722-4b68-baef-daa861e318cb"
      assistant-id="d51d1b88-ede9-4363-a6af-4fa165bd0e3b"
      mode="chat"
      theme="light"
      base-bg-color="#ffffff"
      accent-color="#14B8A6"
      cta-button-color="#ffffff"
      cta-button-text-color="#000000"
      border-radius="large"
      size="compact"
      position="top-right"
      title="AGENDA TU CITA POR CHAT"
      start-button-text="Iniciar Chat"
      end-button-text="Finalizar Chat"
      chat-first-message="¡Hola! Aquí podrás agendar tus citas en Cemdi para Famisanar. ¿Con quién estoy hablando?"
      chat-placeholder="Escribe tu consulta para agendar cita..."
      voice-show-transcript="false"
      consent-required="true"
      consent-title="Términos y Condiciones"
      consent-content="Al hacer clic en &quot;Aceptar&quot;, y cada vez que interactúo con este agente de IA, consiento la grabación, almacenamiento y compartición de mis comunicaciones con proveedores de servicios de terceros, y como se describe en nuestros Términos de Servicio."
      consent-storage-key="vapi_widget_consent"
    >    </vapi-widget>

    <!-- Vapi Widget - Mobile Chat (bottom-right) -->
    <vapi-widget
      class="widget-mobile-chat"
      public-key="d1b861f9-2722-4b68-baef-daa861e318cb"
      assistant-id="d51d1b88-ede9-4363-a6af-4fa165bd0e3b"
      mode="chat"
      theme="light"
      base-bg-color="#ffffff"
      accent-color="#14B8A6"
      cta-button-color="#ffffff"
      cta-button-text-color="#000000"
      border-radius="large"
      size="compact"
      position="bottom-right"
      title="AGENDA TU CITA POR CHAT"
      start-button-text="Iniciar Chat"
      end-button-text="Finalizar Chat"
      chat-first-message="¡Hola! Aquí podrás agendar tus citas en Cemdi para Famisanar. ¿Con quién estoy hablando?"
      chat-placeholder="Escribe tu consulta para agendar cita..."
      voice-show-transcript="false"
      consent-required="true"
      consent-title="Términos y Condiciones"
      consent-content="Al hacer clic en &quot;Aceptar&quot;, y cada vez que interactúo con este agente de IA, consiento la grabación, almacenamiento y compartición de mis comunicaciones con proveedores de servicios de terceros, y como se describe en nuestros Términos de Servicio."
      consent-storage-key="vapi_widget_consent"
    >    </vapi-widget>

    <!-- Vapi Widget - Mobile Voice (bottom-right) -->
    <vapi-widget
      class="widget-mobile-voice"
      public-key="d1b861f9-2722-4b68-baef-daa861e318cb"
      assistant-id="af4dff63-5501-430b-aee2-b0b3ef64e746"
      mode="voice"
      theme="light"
      base-bg-color="#ffffff"
      accent-color="#14B8A6"
      cta-button-color="#ffffff"
      cta-button-text-color="#000000"
      border-radius="large"
      size="compact"
      position="bottom-right"
      title="AGENDA TU CITA POR VOZ"
      start-button-text="Iniciar Llamada"
      end-button-text="Finalizar Llamada"
      chat-first-message="¡Hola! Aquí podrás agendar tus citas en Cemdi para Famisanar. ¿Con quién estoy hablando?"
      chat-placeholder="Habla para agendar tu cita..."
      voice-show-transcript="false"
      consent-required="true"
      consent-title="Términos y Condiciones"
      consent-content="Al hacer clic en &quot;Aceptar&quot;, y cada vez que interactúo con este agente de IA, consiento la grabación, almacenamiento y compartición de mis comunicaciones con proveedores de servicios de terceros, y como se describe en nuestros Términos de Servicio."
      consent-storage-key="vapi_widget_consent"
    >    </vapi-widget>

    <!-- Animated arrow pointing to widget button -->
    <div class="widget-arrow" id="widget-arrow" style="
      position: fixed;
      bottom: 120px;
      right: 20px;
      z-index: 999;
      animation: bounce-arrow 2s infinite;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    ">
      <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 20L12 8M12 8L8 12M12 8L16 12" stroke="#14B8A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>

    <!-- Vapi Widget - Desktop VOICE (top-right, alterna con slider) -->
    <vapi-widget
      class="widget-desktop-voice"
      public-key="d1b861f9-2722-4b68-baef-daa861e318cb"
      assistant-id="af4dff63-5501-430b-aee2-b0b3ef64e746"
      mode="voice"
      theme="light"
      base-bg-color="#ffffff"
      accent-color="#14B8A6"
      cta-button-color="#ffffff"
      cta-button-text-color="#000000"
      border-radius="large"
      size="compact"
      position="top-right"
      title="AGENDA TU CITA POR VOZ"
      start-button-text="Iniciar Llamada"
      end-button-text="Finalizar Llamada"
      chat-first-message="¡Hola! Aquí podrás agendar tus citas en Cemdi para Famisanar. ¿Con quién estoy hablando?"
      chat-placeholder="Habla para agendar tu cita..."
      voice-show-transcript="false"
      consent-required="true"
      consent-title="Términos y Condiciones"
      consent-content="Al hacer clic en &quot;Aceptar&quot;, y cada vez que interactúo con este agente de IA, consiento la grabación, almacenamiento y compartición de mis comunicaciones con proveedores de servicios de terceros, y como se describe en nuestros Términos de Servicio."
      consent-storage-key="vapi_widget_consent"
    >    </vapi-widget>

    <style>
      /* Show only one widget por breakpoint; en desktop alterna slider */
      .widget-desktop{ display:block }
      .widget-desktop-voice{ display:none }
      .widget-mobile-chat{ display:none }
      .widget-mobile-voice{ display:none }
      @media (max-width: 768px){
        .widget-desktop{ display:none }
        .widget-desktop-voice{ display:none }
        .widget-mobile-chat{ display:block }
        .widget-mobile-voice{ display:none }
      }
      @keyframes bounce-arrow {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0) scale(1);
        }
        40% {
          transform: translateY(-12px) scale(1.1);
        }
        60% {
          transform: translateY(-6px) scale(1.05);
        }
      }

      @keyframes pulse-glow {
        0%, 100% {
          box-shadow: 0 0 10px rgba(20, 184, 166, 0.3);
        }
        50% {
          box-shadow: 0 0 20px rgba(20, 184, 166, 0.6);
        }
      }

      .widget-arrow {
        transition: all 0.3s ease;
      }

      .widget-arrow:hover {
        transform: scale(1.1);
      }

      .widget-arrow svg {
        filter: drop-shadow(0 2px 8px rgba(20, 184, 166, 0.4));
        transition: all 0.3s ease;
      }

      .widget-arrow svg:hover {
        filter: drop-shadow(0 4px 12px rgba(20, 184, 166, 0.6));
      }

      /* Widget arrow responsive positioning is now handled by JavaScript */

      /* Add subtle glow effect */
      .widget-arrow::before {
        content: '';
        position: absolute;
        top: -5px;
        left: -5px;
        right: -5px;
        bottom: -5px;
        background: radial-gradient(circle, rgba(20, 184, 166, 0.1) 0%, transparent 70%);
        border-radius: 50%;
        animation: pulse-glow 3s ease-in-out infinite;
        pointer-events: none;
      }

      /* Toggle slider Chat <-> Voz */
      .toggle {
        position: relative;
        display: inline-block;
        width: 112px;
        height: 44px;
      }
      .toggle input { display: none; }
      .toggle .slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background: #e5e7eb; /* slate-200 */
        border-radius: 9999px;
        border: 1px solid #cbd5e1; /* slate-300 */
        transition: background .25s ease;
        display: flex; align-items: center; justify-content: space-between;
        padding: 0 12px;
        font-family: Inter, system-ui, sans-serif;
        font-size: 12px; font-weight: 600; color: #0f172a; /* slate-900 */
      }
      .toggle .slider::before {
        content: '';
        position: absolute;
        height: 40px; width: 40px;
        left: 2px; top: 2px;
        background: #ffffff;
        border-radius: 9999px;
        box-shadow: 0 2px 6px rgba(15,23,42,.15);
        transition: transform .25s ease;
      }
      .toggle .label-left { color: #0f766e; } /* Chat color */
      .toggle .label-right { color: #334155; opacity: .7; } /* Voz off */
      .toggle input:checked + .slider {
        background: #0f766e; /* primary darker when voice on */
        color: #ffffff;
      }
      .toggle input:checked + .slider::before { transform: translateX(68px); }
      .toggle input:checked + .slider .label-left { color: #e2e8f0; opacity: .85; }
      .toggle input:checked + .slider .label-right { color: #ffffff; opacity: 1; }

      /* Mobile slider - smaller size */
      .toggle-mobile {
        width: 90px !important;
        height: 36px !important;
      }
      .toggle-mobile .slider {
        font-size: 11px !important;
        padding: 0 10px !important;
      }
      .toggle-mobile .slider::before {
        height: 32px !important;
        width: 32px !important;
        left: 2px !important;
        top: 2px !important;
      }
      .toggle-mobile input:checked + .slider::before {
        transform: translateX(54px) !important;
      }
    </style>

    <div id="root">
      <!-- Loading state while React loads -->
      <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(to bottom right, #ffffff, #f8fafc);">
        <div style="text-align: center;">
          <div class="loading-spinner"></div>
          <p style="color: #64748b; margin-top: 16px; font-family: system-ui, sans-serif;">Cargando Portal de Agendamientos...</p>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>